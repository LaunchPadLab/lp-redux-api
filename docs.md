<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [getAuthenticationContext](#getauthenticationcontext)
-   [http](#http)
-   [HttpError](#httperror)
-   [isAuthenticated](#isauthenticated)
-   [isAuthenticatedWithContext](#isauthenticatedwithcontext)
-   [LP_API](#lp_api)
-   [onResponse](#onresponse)
-   [reducer](#reducer)
-   [requestWithKey](#requestwithkey)
-   [selectStatus](#selectstatus)
-   [setFromRequest](#setfromrequest)
-   [api](#api)

## getAuthenticationContext

A helper function to retrieve the authentication context for the 
authenticated user.

This function returns the context string when the LP Redux Api cookie exists, 
contains a token, and contains a context.

This function returns `undefined` when there is no context present,
or if the LP Redux API cookie does not exist.

**Examples**

```javascript
// After an 'admin' signs in
getAuthenticationContext() // 'admin'

// After a user with no context signs in
getAuthenticationContext() // undefined 

// After sign out
getAuthenticationContext() // undefined
```

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 

## http

A wrapper function for the [Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)
that adds default request settings and handles CRSF token logic.

This function adds the following config settings to the given request:

    {
      credentials: 'same-origin',
      headers: [
        'Accept': 'application/json',
        'X-Requested-With': 'XMLHttpRequest',
        'Content-Type': 'application/json'
      ],
      mode: 'same-origin'
    }

Any one of these settings can be overriden using the passed-in config object.

In addition to the normal Fetch API settings, the config object may also contain two special settings just for `http`:

-   `'root'`: A path to be appended to the given endpoint (default=`''`).
-   `'crsf'`: The name of the `meta` tag containing the CSRF token (default=`'csrf-token'`). This can be set to `false` to prevent a token from being sent.

**Parameters**

-   `endpoint` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The URL of the request
-   `config` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** An object containing config information for the `Fetch` request, as well as the extra keys noted above.

**Examples**

```javascript
function getUsers () {
  return http('/users', { 
     root: 'www.my.cool.api.com', 
     crsf: 'custom-token-name'
  })
}

getUsers()
   .then(res => console.log('The users are', res))
   .catch(err => console.log('An error occurred!', err))
```

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** A Promise that either resolves with the response or rejects with an [HttpError](#httperror).

## HttpError

**Extends Error**

An error class that is thrown by the [http](http) module when a request fails.

In addition to the standard [Error](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error) attributes, instances of `HttpError` include the following:

-   `status`: the status code of the response
-   `statusText`: the status text of the response
-   `response`: the full response object
-   `message`: A readable error message with format `<status> - <statusText>`

**Parameters**

-   `status` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** the status code of the response
-   `statusText` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** the status text of the response
-   `response` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** the full response object

**Examples**

```javascript
// Instantiated manually
const MyError = new HttpError(500, 'Something went wrong!')
console.log(MyError.toString()) // "HttpError: 500 - Something went wrong"

// Instantiated by http module
http('/bad-route').catch(err => console.log(err.name)) // -> "HttpError"
```

## isAuthenticated

A helper function to determine if the current user is authenticated.
This returns true when the LP Redux Api cookie exists and contains a
token.

Note, this does not **validate** the token, it only checks for
presence, validation must be done on the server.

**Examples**

```javascript
// After sign in
isAuthenticated() // true

// After sign out
isAuthenticated() // false
```

Returns **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

## isAuthenticatedWithContext

A helper function to determine if the current user is authenticated
for a specific context. This is useful if the client needs to know
more about the type of user that is logged in.

This returns true when the LP Redux Api cookie exists, contains a
token, and contains the specified context.

Note, this does not **validate** the token, it only checks for
presence, validation must be done on the server.

**Parameters**

-   `context` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** a context that corresponds to one provided by the server

**Examples**

```javascript
// After an 'admin' signs in
isAuthenticatedWithContext('admin') // true

isAuthenticatedWithContext('non-admin') // false

isAuthenticatedWithContext() // false

// After sign out
isAuthenticatedWithContext('admin') // false

isAuthenticatedWithContext('non-admin') // false

isAuthenticatedWithContext() // false
```

Returns **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

## LP_API

A unique key that identifies dispatched actions to be handled by the LP
Redux Api middleware. This is implemented as a Symbol, instead of a String
to guarantee uniqueness.

The params provided as the value include anything that is supported by
[LP Redux Api Middleware](Middlware)

**Examples**

```javascript
// An example action creator
function fooAction () {
  return {
    [LP_API]: {
      url: 'http://foo.com/posts',
      types: ['REQUEST', 'SUCCESS', 'FAILURE'],
      // ...
    }
  }
}
```

## onResponse

A function that returns a React HOC to handle rendering that depends on an API response. 
A combination of [selectStatus](#selectstatus) and `onMount` from `lp-utils`.

**Parameters**

-   `requestKeys` **([String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array))?= \[]** A key or set of keys corresponding to `lp-redux-api` requests.
-   `LoadingComponent` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)?** A component to render during the loading state. (optional, default `null`)

**Examples**

```javascript
import { REQ_USERS, requestUsers } from 'actions'

 function MyComponent (name) {
   return (
     <p>{name}</p>
   )
 }

 export default compose(
   onMount(requestUsers),
   onResponse(REQ_USERS),
 )(MyComponent)
 
 // requestUsers() dispatches an LP_API action with key 'REQ_USERS' on component mount.
 // When the status of 'REQ_USERS' request becomes 'success' or 'failure', the component will render.
 // Otherwise, the default {@link onMount} loading component will be rendered.
```

Returns **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** A higher order component (HOC).

## reducer

Stores the status of API requests in your state.
Statuses are stored for all requests with a `requestKey` (including those created by [requestWithKey](#requestwithkey)),
and can be retrieved by using [selectStatus](#selectstatus).

To use this reducer, add it to `combineReducers()` under the `api` key. You can use a different key if you'd like,
but you will need to reference it explicitly when using [selectStatus](#selectstatus).

**Examples**

```javascript
// When creating store, attach reducer

import { reducer as apiReducer } from 'lp-redux-api'

combineReducers({ 
  api: apiReducer,
  ...
})

// Now you can keep track of request status elsewhere in your app

import { requestKey, selectStatus } from 'lp-redux-api'

const REQ_FETCH_USERS = 'REQ_FETCH_USERS'
dispatch(requestWithKey(REQ_FETCH_USERS, { url: '/users' }))

selectStatus(REQ_FETCH_USERS, state) // -> 'loading'
```

## requestWithKey

An action creator that automatically adds a requestKey and default actions to your request.
These default actions can then be picked up by [setFromRequest](#setfromrequest).

Default actions are dynamically named using the key provided, like so:

-   `<requestKey>_REQUEST`
-   `<requestKey>_SUCCESS`
-   `<requestKey>_FAILURE`

**Parameters**

-   `requestKey` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** A unique key that you can use to reference your request in [setFromRequest](#setfromrequest) or [selectStatus](#selectstatus)
-   `options` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)?= {}** Config options that you would normally include in an [LP_API] action, such as `url` and `method`

**Examples**

```javascript
export const REQ_FETCH_USERS = 'REQ_FETCH_USERS'

export const fetchUsers = requestWithKey(REQ_FETCH_USERS, {
  url: '/users'
})

fetchUsers()

// {
//   [LP_API]: {
//     url: '/users',
//     requestKey: 'REQ_FETCH_USERS',
//     actions: ['REQ_FETCH_USERS_REQUEST', 'REQ_FETCH_USERS_SUCCESS', 'REQ_FETCH_USERS_FAILURE']
//   }
// }
```

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** An [LP_API] action that can be handled by the lp-redux-api middleware.

## selectStatus

A function that, given the redux state, returns the status of a given API request. 
In order to work, the `lp-redux-api` reducer must be included in `combineReducers()`.

The status of a request can be one of the following exported constants:

-   `LP_API_STATUS_LOADING`: `'loading'`
-   `LP_API_STATUS_SUCCESS`: `'success'`
-   `LP_API_STATUS_FAILURE`: `'failure'`

**Parameters**

-   `requestKey` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** A unique key that references a request created by [requestWithKey](#requestwithkey)
-   `state` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The state of your redux store
-   `slice` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** The path to the slice of state handled by the `lp-redux-api` reducer (optional, default `'api'`)

**Examples**

```javascript
// When creating store, attach reducer

import { reducer as apiReducer } from 'lp-redux-api'

combineReducers({ 
  api: apiReducer,
  ...
})

// Now you can keep track of request status elsewhere in your app

import { requestKey, selectStatus } from 'lp-redux-api'

const REQ_FETCH_USERS = 'REQ_FETCH_USERS'
dispatch(requestWithKey(REQ_FETCH_USERS, { url: '/users' }))

selectStatus(REQ_FETCH_USERS, state) // -> 'loading'
```

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** A string constant indicating request status

## setFromRequest

A function that creates action handlers for actions generated by [requestWithKey](#requestwithkey).
These handlers set data in the state from the response(s) of a given request.

By default, setFromRequest creates handlers for `<requestKey>_SUCCESS` and `<requestKey>_FAILURE` action types.
You can override either of these handlers in your reducer by creating handlers explicitly.

Current behavior (subject to change):

-   If the request is successful, the response will be set at `<path>.data`, and `<path>.error` will be `null`
-   If the request is unsuccessful, the response will be set at `<path>.error`, and `<path>.data` will be `null`

**Parameters**

-   `requestKey` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** A unique key that references a request created by [requestWithKey](#requestwithkey)
-   `path` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** A path (in dot notation) indicating where the data will be set in the state

**Examples**

```javascript
const REQ_FETCH_USERS = 'REQ_FETCH_USERS'

 const initialState = {
  user: {
    data: null,
    error: null
  }
 }

export const reducer = (state=initialState, action) => {
  const handlers = {
    ...setFromRequest(REQ_FETCH_USERS, 'user')
  }
  const handler = handlers[action.type]
  if (!handler) return state
  return handler(state, action)
}

// On success, this call returns userData
const fetchUsers = requestWithKey(REQ_FETCH_USERS, { url: '/users' })

dispatch(fetchUsers()) 

// On success, new state will be:
// {
//    user: {
//      data: userData,
//      error: null
//    } 
// }
```

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** An hash of action handlers that can be included in a reducer by using object spread syntax

## api

A lightweight wrapper around the [http](http) module.
Provides functions to make API requests with specified HTTP methods.

The functions are as follows:

-   `get(url, options)` sends a `'GET'` request
-   `patch(url, body, options)` sends a `'PATCH'` request
-   `post(url, body, options)` sends a `'POST'` request
-   `put(url, body, options)` sends a `'PUT'` request
-   `destroy(url, body, options)` sends a `'DELETE'` request
-   `call(url, method, body, options)` sends a request with specified method

Each function can be passed an `options` object, which will eventually be forwarded
to the [Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API).

Each function returns a promise, which will either resolve with a response object
or reject with an [HTTPError](HTTPError).

**Examples**

```javascript
function getUsers () {
  return api.get('/users', { credentials: 'include' })
}

getUsers()
   .then(res => console.log('The users are', res))
   .catch(err => console.log('An error occurred!', err))
```
