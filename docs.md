<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [LP_API](#lp_api)
-   [middleware](#middleware)
    -   [Actions](#actions)
    -   [Middleware configuration](#middleware-configuration)
-   [onResponse](#onresponse)
-   [reducer](#reducer)
-   [requestWithKey](#requestwithkey)
-   [selectors](#selectors)
-   [setFromRequest](#setfromrequest)

## LP_API

A unique key that identifies dispatched actions to be handled by the LP
Redux Api middleware. This is implemented as a Symbol, instead of a String
to guarantee uniqueness.

The params provided as the value include anything that is supported by
[LP Redux Api Middleware](#middleware)

**Examples**

```javascript
// An example action creator
function fooAction () {
  return {
    [LP_API]: {
      url: 'http://foo.com/posts',
      requestAction: 'REQUEST', 
      successAction: 'SUCCESS', 
      failureAction: 'FAILURE',
    }
  }
}
```

## middleware

### Actions

At a high level, `lp-redux-api` actions contain the following information:

-   The URL of an API request to execute
-   Any extra request details
-   One or many actions to dispatch based on the status of the request

These actions are keyed using the [LP_API](#lp_api) symbol so that the middleware knows to handle them. Here's an example of a simple action creator:

    import { LP_API } from '@launchpadlab/lp-redux-api'

    export function fetchUser (id) {
      return {
        [LP_API]: {
          url: `users/${id}`,
          requestAction: 'USER_REQUEST', 
          successAction: 'USER_SUCCESS', 
          failureAction: 'USER_FAILURE',
          ... any more configuration options 
        },
      }
    }

When this action is dispatched to the store, the middleware will take over and:

-   Dispatch a `USER_REQUEST` action
-   Perform the api request to `/users`
-   Dispatch a `USER_SUCCESS` action with the response payload if the api request is successful
-   Dispatch a `USER_FAILURE` action with the error payload if the api request fails

Actions can be defined in the following ways:

-   As an action type `string` (shown above)
-   As an action `object`
-   As an action creator `function` - will get passed the success/error response as modified by `successDataPath` and `failureDataPath` (see below)

### Middleware configuration

In order to use `lp-redux-api` actions, you must apply the custom middleware to your store when the store is created:

    import { middleware as apiMiddleware } from '@launchpadlab/lp-redux-api'
    const apiConfig = { ... }
    const middleware = applyMiddleware(
       apiMiddleware(apiConfig),
       ...
    )
    const store = createStore(reducer, initialState, middleware)

The following options can be used to configure the middleware:

-   `onUnauthorized` (default=`null`): An action creator to be called and dispatched when the server rejects a request with a status of `unauthorized`.
-   `successDataPath`: A path to response data that will be passed as the success action's payload
-   `failureDataPath`: A path to response data that will be passed as the failure action's payload
-   any options used by the lp-requests [http](https://github.com/LaunchPadLab/lp-requests/blob/master/docs.md#http) module

## onResponse

A function that returns a React HOC to handle rendering that depends on an API response. 
A combination of [selectors](#selectors) and `onLoad` from `lp-utils`.

**Parameters**

-   `requestKeys` **([String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array))?= \[]** A key or set of keys corresponding to `lp-redux-api` requests.
-   `LoadingComponent` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)?** A component to render during the loading state. (optional, default `null`)

**Examples**

```javascript
import { REQ_USERS, requestUsers } from 'actions'

 function MyComponent (name) {
   return (
     <p>{name}</p>
   )
 }

 export default compose(
   onMount(requestUsers),
   onResponse(REQ_USERS),
 )(MyComponent)
 
 // requestUsers() dispatches an LP_API action with key 'REQ_USERS' on component mount.
 // When the status of 'REQ_USERS' request becomes 'success' or 'failure', the component will render.
 // Otherwise, the default `onLoad` loading component will be rendered.
```

Returns **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** A higher order component (HOC).

## reducer

Stores the status of API requests in your state.
Statuses are stored for all requests with a `requestKey` (including those created by [requestWithKey](#requestwithkey)),
and can be retrieved by using [selectStatus](selectStatus).

To use this reducer, add it to `combineReducers()` under the `api` key. You can use a different key if you'd like,
but you will need to reference it explicitly when using [selectStatus](selectStatus).

**Examples**

```javascript
// When creating store, attach reducer

import { reducer as apiReducer } from 'lp-redux-api'

combineReducers({ 
  api: apiReducer,
  ...
})

// Now you can keep track of request status elsewhere in your app

import { requestKey, selectStatus } from 'lp-redux-api'

const REQ_FETCH_USERS = 'REQ_FETCH_USERS'
dispatch(requestWithKey(REQ_FETCH_USERS, { url: '/users' }))

selectStatus(REQ_FETCH_USERS, state) // -> 'loading'
```

## requestWithKey

An action creator that automatically adds a requestKey and default actions to your request.
These default actions can then be picked up by [setFromRequest](#setfromrequest).

Default actions are dynamically named using the key provided, like so:

-   `<requestKey>_REQUEST`
-   `<requestKey>_SUCCESS`
-   `<requestKey>_FAILURE`

**Parameters**

-   `requestKey` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** A unique key that you can use to reference your request in [setFromRequest](#setfromrequest) or [selectStatus](selectStatus)
-   `options` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)?= {}** Config options that you would normally include in an [LP_API] action, such as `url` and `method`

**Examples**

```javascript
export const REQ_FETCH_USERS = 'REQ_FETCH_USERS'

export const fetchUsers = requestWithKey(REQ_FETCH_USERS, {
  url: '/users'
})

fetchUsers()

// {
//   [LP_API]: {
//     url: '/users',
//     requestKey: 'REQ_FETCH_USERS',
//     requestAction: 'REQ_FETCH_USERS_REQUEST', 
//     successAction: 'REQ_FETCH_USERS_SUCCESS', 
//     failureAction: 'REQ_FETCH_USERS_FAILURE',
// }
```

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** An [LP_API] action that can be handled by the lp-redux-api middleware.

## selectors

This library exports the following selectors for determining the status of requests:

-   `selectors.status(state, requestKey)`
-   `selectors.hasStatus(state, requestKey, [slice])`
-   `selectors.isLoading(state, requestKey, [slice])`
-   `selectors.isSuccess(state, requestKey, [slice])`
-   `selectors.isFailure(state, requestKey, [slice])`

In order to work, the `lp-redux-api` reducer must be included in `combineReducers()`.
Selectors expect the reducer to be keyed under `'api'`- if a different key is used,
it must be passed as the optional `slice` parameter.

The status returned by `selectors.status()` can be one of the following exported constants:

-   `LP_API_STATUS_LOADING`: `'loading'`
-   `LP_API_STATUS_SUCCESS`: `'success'`
-   `LP_API_STATUS_FAILURE`: `'failure'`

**Examples**

```javascript
// When creating store, attach reducer

import { reducer as apiReducer } from 'lp-redux-api'

combineReducers({ 
  api: apiReducer,
  ...
})

// Now you can keep track of request status elsewhere in your app

import { requestWithKey, selectors as apiSelectors } from 'lp-redux-api'

const REQ_FETCH_USERS = 'REQ_FETCH_USERS'
dispatch(requestWithKey(REQ_FETCH_USERS, { url: '/users' }))

apiSelectors.status(state, REQ_FETCH_USERS) // -> 'loading'
```

## setFromRequest

A function that creates action handlers for actions generated by [requestWithKey](#requestwithkey).
These handlers set data at a path in the state from the response(s) of a given request.

If the request is successful, the data will be set at `<path>.success`.
If the request is unsuccessful, the data will be set at `<path>.failure`.

By default, setFromRequest creates handlers for `<requestKey>_SUCCESS` and `<requestKey>_FAILURE` action types.
You can override either of these handlers in your reducer by creating handlers explicitly.

**Parameters**

-   `requestKey` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** A unique key that references a request created by [requestWithKey](#requestwithkey)
-   `path` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** A path (in dot notation) indicating where the data will be set in the state

**Examples**

```javascript
const REQ_FETCH_USERS = 'REQ_FETCH_USERS'

 const initialState = {
  user: {
    data: null,
    error: null
  }
 }

export const reducer = (state=initialState, action) => {
  const handlers = {
    ...setFromRequest(REQ_FETCH_USERS, 'user')
  }
  const handler = handlers[action.type]
  if (!handler) return state
  return handler(state, action)
}

// On success, this call returns userData
const fetchUsers = requestWithKey(REQ_FETCH_USERS, { url: '/users' })

dispatch(fetchUsers()) 

// On success, new state will be:
// {
//    user: { success: userData }
// }
```

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** A hash of action handlers that can be included in a reducer by using object spread syntax
